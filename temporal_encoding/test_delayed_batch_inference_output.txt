================================================================================
æµ‹è¯•ï¼šå»¶è¿Ÿæ‰¹é‡ç¼–ç æ–¹æ¡ˆ (Delayed Batch Inference)
================================================================================

ğŸ“¦ åŠ è½½æ¨¡å‹: /root/autodl-tmp/Qwen/Qwen2___5-VL-3B-Instruct
Loading checkpoint shards:   0%|                                                                                     | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|######################################5                                      | 1/2 [00:01<00:01,  1.39s/it]Loading checkpoint shards: 100%|#############################################################################| 2/2 [00:02<00:00,  1.22s/it]Loading checkpoint shards: 100%|#############################################################################| 2/2 [00:02<00:00,  1.24s/it]

ğŸš€ åˆå§‹åŒ– DelayedBatchInferenceEngineï¼ˆå¯ç”¨ 1fps é‡‡æ · + ç»å¯¹æ—¶é—´ç¼–ç  + ç¡¬ç›˜ç¼“å­˜ï¼‰
âœ… SmartFrameManager Initialized:
   ğŸ“Œ Star Memory: 20 frames
   ğŸŒŠ Stream Window: 20 frames
   ğŸ¯ Importance Threshold: 0.6
   ğŸ’¾ Disk Cache: /tmp/qwen_vl_frames_tghixd42
   ğŸ¯ Target FPS: 1.0
   ğŸ“Š Max Sampled Frames: 48
   â±ï¸  Absolute Time Encoding: True
âœ… DelayedBatchInferenceEngine Initialized
   ğŸ“ Max Pixels: 100352 (316x316)
   ğŸ¬ Strategy: æµå¼æ”¶é›† + å»¶è¿Ÿæ‰¹é‡ç¼–ç 
âœ… åŠ è½½ 50 å¸§

================================================================================
é˜¶æ®µ 1ï¼šæµå¼æ·»åŠ å¸§ï¼ˆæ¨¡æ‹Ÿ50ç§’è§†é¢‘ï¼‰
================================================================================
  [10/50] t=9.0s | Frame #10 added to Stream Memory | Star: 2, Stream: 10
  [20/50] t=19.0s | Frame #20 added to Stream Memory | Star: 2, Stream: 20
  [30/50] t=29.0s | Frame #30 added to Stream Memory | Star: 2, Stream: 20
  [40/50] t=39.0s | Frame #40 added to Stream Memory | Star: 2, Stream: 20
  [50/50] t=49.0s | Frame #50 added to Stream Memory | Star: 2, Stream: 20

âœ… æ‰€æœ‰å¸§å·²æ·»åŠ ï¼Œæ¨¡æ‹Ÿè§†é¢‘æ—¶é•¿: 50.0s

ğŸ“Š å¸§ç®¡ç†ç»Ÿè®¡:
  total_frames_added: 50
  encode_count: 0
  cache_valid: False
  star_memory_size: 2
  stream_memory_size: 20
  unique_frames: 22
  compression_ratio: 2.27x
  disk_cache_enabled: True

================================================================================
é˜¶æ®µ 2ï¼šæé—®æµ‹è¯•ï¼ˆè§¦å‘åŠ¨æ€é‡‡æ · + ç»å¯¹æ—¶é—´ç¼–ç ï¼‰
================================================================================

â“ é—®é¢˜ 1: è¯·æè¿°è§†é¢‘ä¸­çš„ä¸»è¦å†…å®¹ã€‚
   ğŸ§¹ æ˜¾å­˜é‡Šæ”¾å: å·²åˆ†é… 6.99GB, å·²ä¿ç•™ 7.07GB
   ğŸ“¹ é‡‡æ ·: 22 â†’ 48 å¸§
   â±ï¸  second_per_grid_t: 2.0417s
   ğŸ• å®é™…æ—¶é—´è·¨åº¦: 49.00s (ä» t=0.0s åˆ° t=49.0s)
   âœ… ç¼–ç å®Œæˆï¼
   â±ï¸  è€—æ—¶: 20.96s
   ğŸ¯ Visual Tokens: 64584
   ğŸ’¾ KV Cache Length: 64607
   ğŸ“ video_grid_thw: tensor([[ 24,  78, 138]], device='cuda:0')
ğŸ’¬ å›ç­”: è§†é¢‘å±•ç¤ºäº†ä¸€ä¸ªç”µè§†èŠ‚ç›®ã€Šä¸­å›½å¥½å£°éŸ³ã€‹çš„ç‰‡æ®µï¼Œå…¶ä¸­ä¸€ä½é€‰æ‰‹è‘£ä¹¦å«åœ¨èˆå°ä¸Šè¡¨æ¼”æ­Œæ›²ã€Šä¸‹ä¸€ä¸ªå¤©äº®ã€‹ï¼Œå¥¹ç©¿ç€ç™½è‰²è¿è¡£è£™ï¼Œæ‰‹æŒéº¦å…‹é£æ·±æƒ…æ¼”å”±ã€‚

### ç”»é¢å†…å®¹æ¦‚è¿°ï¼š

1. **èˆå°èƒŒæ™¯**ï¼šèˆå°ç¯å…‰æ•ˆæœç»šä¸½å¤šå½©ï¼Œä¸»è¦ä»¥è“è‰²å’Œç´«è‰²ä¸ºä¸»ï¼Œè¥é€ å‡ºä¸€ç§æ¢¦å¹»èˆ¬çš„æ°›å›´ã€‚
2. **æ­Œæ‰‹ä»‹ç»**ï¼š
   - è‘£ä¹¦å«æ˜¯ä¸€ä½å¹´è½»çš„å¥³æ­Œæ‰‹ï¼Œåœ¨èŠ‚ç›®ä¸­è¡¨ç°å‡ºè‰²ã€‚
   - å¥¹æ­£åœ¨å”±ä¸€é¦–æƒ…æ„Ÿä¸°å¯Œçš„æ­Œæ›²ï¼Œè¡¨æƒ…ä¸“æ³¨ä¸”æŠ•å…¥ã€‚
3. **è¯„å§”ååº”**ï¼š
   - èŠ‚ç›®ä¸­æœ‰å‡ ä½è¯„å§”ååœ¨çº¢è‰²æ¤…å­ä¸Šï¼Œä»–ä»¬å¯¹è‘£ä¹¦å«çš„è¡¨ç°ç»™äºˆäº†é«˜åº¦è¯„ä»·ï¼Œå¹¶ç»™äºˆçƒ­çƒˆæŒå£°ã€‚
4. **è§‚ä¼—ååº”**ï¼š
   - è§‚ä¼—å¸­ä¸Šçš„ç²‰ä¸ä»¬ä¹Ÿçƒ­æƒ…é¼“æŒï¼Œä¸ºå¥¹çš„ç²¾å½©è¡¨ç°å–å½©ã€‚
5. **æ­Œè¯å­—å¹•**ï¼š
   - æ¼”å”±è¿‡ç¨‹ä¸­å±å¹•ä¸‹æ–¹æ˜¾ç¤ºç€æ­Œè¯ï¼Œå¢åŠ äº†è§‚çœ‹ä½“éªŒã€‚
6. **å…¶ä»–ç»†èŠ‚**ï¼š
   - ç¯å¢ƒå¸ƒç½®ç²¾è‡´ï¼Œæ•´ä½“è‰²è°ƒå’Œè°ç»Ÿä¸€ï¼Œä½¿å¾—æ•´ä¸ªåœºæ™¯æ˜¾å¾—éå¸¸ä¸“ä¸šå’Œæœ‰å±‚æ¬¡æ„Ÿã€‚

### åˆ†æä¸æ€»ç»“

é€šè¿‡è¿™æ®µè§†é¢‘å¯ä»¥çœ‹å‡ºï¼Œã€Šä¸­å›½å¥½å£°éŸ³ã€‹æ˜¯ä¸€ä¸ªå……æ»¡æ¿€æƒ…ä¸æ‰åçš„éŸ³ä¹
ğŸ“Š æŒ‡æ ‡:
  total_latency: 31.49s
  generation_latency: 4.82s
  output_tokens: 256
  encoding_latency: 20.96s
  frames_encoded: 48
  visual_tokens: 64584

ğŸ“ é‡‡æ ·å…ƒæ•°æ®éªŒè¯:
  åŸå§‹å¸§æ•°: 22
  é‡‡æ ·åå¸§æ•°: 48
  second_per_grid_t: 2.0417s
  temporal_grids: 24
  å‹ç¼©æ¯”: 0.46x
  æ—¶é—´ç¼–ç éªŒè¯: âœ… é€šè¿‡
  è¦†ç›–æ—¶é•¿: 49.00s / 49.00s

â“ é—®é¢˜ 2: è§†é¢‘ä¸­æœ‰ä»€ä¹ˆäººç‰©æˆ–ç‰©ä½“ï¼Ÿ
ğŸ’¬ å›ç­”: åœ¨ã€Šä¸­å›½å¥½å£°éŸ³ã€‹çš„èˆå°ä¸Šï¼Œå¯ä»¥çœ‹åˆ°ä»¥ä¸‹ä¸»è¦äººç‰©å’Œç‰©å“ï¼š

1. **è‘£ä¹¦å«**ï¼šå¹´è½»å¥³æ­Œæ‰‹ï¼Œèº«ç©¿ç™½è‰²è¿è¡£è£™ï¼Œæ­£åœ¨æ·±æƒ…æ¼”å”±ã€‚
2. **è¯„å§”å¸­ä¸Šçš„å‡ ä½è¯„å§”**ï¼š
   - ä»–ä»¬ååœ¨çº¢è‰²æ¤…å­ä¸Šï¼Œå¯¹è‘£ä¹¦å«çš„è¡¨ç°ç»™äºˆäº†é«˜åº¦è¯„ä»·ï¼Œå¹¶ç»™äºˆçƒ­çƒˆæŒå£°ã€‚
3. **è§‚ä¼—å¸­ä¸Šçš„ç²‰ä¸ä»¬**ï¼š
   - é¼“æŒä¸ºå¥¹çš„ç²¾å½©è¡¨ç°å–å½©ã€‚

æ­¤å¤–è¿˜æœ‰èˆå°ç¯å…‰ã€èƒŒæ™¯å±å¹•ç­‰å…ƒç´ å¢åŠ äº†èŠ‚ç›®çš„è§‚èµæ€§ã€‚
ğŸ“Š æŒ‡æ ‡:
  total_latency: 2.17s
  generation_latency: 2.07s
  output_tokens: 109

â“ é—®é¢˜ 3: è§†é¢‘ä¸­æœ‰ä»€ä¹ˆåœºæ™¯å˜åŒ–ï¼Ÿ
ğŸ’¬ å›ç­”: åœ¨ã€Šä¸­å›½å¥½å£°éŸ³ã€‹çš„èˆå°ä¸Šï¼Œæœ‰ä»¥ä¸‹å‡ ç§åœºæ™¯çš„å˜åŒ–ï¼š

1. **èˆå°èƒŒæ™¯**ï¼šä»ä¸€å¼€å§‹ç»šä¸½å¤šå½©ã€æ¢¦å¹»èˆ¬çš„ç¯å…‰æ•ˆæœå¼€å§‹ï¼Œåˆ°åæ¥é•œå¤´åˆ‡æ¢è‡³è¯„å§”å¸­å’Œè§‚ä¼—å¸­ã€‚
2. **æ­Œæ‰‹çš„ä½ç½®**ï¼š
   - è‘£ä¹¦å«ç«™åœ¨èˆå°ä¸­å¤®æ¼”å”±æ—¶ï¼Œé•œå¤´ä¸»è¦èšç„¦äºå¥¹èº«ä¸Šã€‚
   - ä¹‹åï¼Œé•œå¤´åˆ‡æ¢åˆ°è¯„å§”ä»¬ï¼Œå±•ç¤ºä»–ä»¬å¯¹å¥¹çš„ååº”ï¼Œå¹¶ç»™äºˆæŒå£°ã€‚
3. **æ­Œè¯å­—å¹•**ï¼š
   - æ¼”å”±è¿‡ç¨‹ä¸­å±å¹•ä¸‹æ–¹æ˜¾ç¤ºç€æ­Œè¯ï¼Œå¢åŠ äº†è§‚çœ‹ä½“éªŒã€‚

è¿™äº›åœºæ™¯å˜åŒ–ä½¿å¾—æ•´ä¸ªèŠ‚ç›®æ›´åŠ ç”ŸåŠ¨æœ‰è¶£ã€‚
ğŸ“Š æŒ‡æ ‡:
  total_latency: 2.48s
  generation_latency: 2.39s
  output_tokens: 127

================================================================================
é˜¶æ®µ 3ï¼šCache å¤ç”¨æµ‹è¯•ï¼ˆToken Streaming è¾“å‡ºï¼‰
================================================================================

ğŸ”„ ç¬¬ 1 æ¬¡æé—®ï¼ˆStreaming è¾“å‡ºï¼Œåº”è¯¥å¤ç”¨ cacheï¼‰
ğŸ’¬ å›ç­”: è¿™ä¸ªèŠ‚ç›®æ˜¯ã€Šä¸­å›½å¥½å£°éŸ³ã€‹ï¼Œåœ¨èŠ‚ç›®ä¸­ï¼Œä¸€ä½å¹´è½»å¥³æ­Œæ‰‹è‘£ä¹¦å«æ·±æƒ…æ¼”å”±æ­Œæ›²ã€Šä¸‹ä¸€ä¸ªå¤©äº®ã€‹ã€‚å¥¹èº«ç©¿ç™½è‰²è¿è¡£è£™ï¼Œåœ¨èˆå°ä¸Šè¡¨ç°å‡ºè‰²ï¼Œå¹¶è·å¾—äº†è¯„å§”å’Œè§‚ä¼—çš„çƒ­çƒˆæŒå£°ã€‚

### è§†é¢‘å†…å®¹æ€»ç»“ï¼š

- **é€‰æ‰‹**ï¼šè‘£ä¹¦å«ï¼ˆå¹´è½»çš„å¥³æ­Œæ‰‹ï¼‰
- **è¡¨æ¼”åœ°ç‚¹**ï¼šèˆå°
- **èƒŒæ™¯éŸ³ä¹**ï¼šæ­Œæ›²ã€Šä¸‹ä¸€ä¸ªå¤©äº®ã€‹
- **åœºæ™¯å˜åŒ–**ï¼š
  - èˆå°ç¯å…‰æ•ˆæœç»šä¸½å¤šå½©ã€‚
  - é•œå¤´åˆ‡æ¢è‡³è¯„å§”å¸­å’Œè§‚ä¼—å¸­ã€‚
  - å±å¹•ä¸‹æ–¹æ˜¾ç¤ºæ­Œè¯å­—å¹•
â±ï¸  æ€»è€—æ—¶: 3.88s
ğŸ“Š è¾“å‡ºtokens: 105
ğŸ“Š ç¼–ç è€—æ—¶: N/A (cacheå¤ç”¨)

ğŸ”„ ç¬¬ 2 æ¬¡æé—®ï¼ˆStreaming è¾“å‡ºï¼Œåº”è¯¥å¤ç”¨ cacheï¼‰
ğŸ’¬ å›ç­”: è¿™ä¸ªèŠ‚ç›®æ˜¯ã€Šä¸­å›½å¥½å£°éŸ³ã€‹ï¼Œåœ¨èŠ‚ç›®ä¸­ï¼Œä¸€ä½å¹´è½»å¥³æ­Œæ‰‹è‘£ä¹¦å«æ·±æƒ…æ¼”å”±æ­Œæ›²ã€Šä¸‹ä¸€ä¸ªå¤©äº®ã€‹ã€‚å¥¹èº«ç©¿ç™½è‰²è¿è¡£è£™ï¼Œåœ¨èˆå°ä¸Šè¡¨ç°å‡ºè‰²ï¼Œå¹¶è·å¾—äº†è¯„å§”å’Œè§‚ä¼—çš„çƒ­çƒˆæŒå£°ã€‚

### è§†é¢‘å†…å®¹æ€»ç»“ï¼š

- **é€‰æ‰‹**ï¼šè‘£ä¹¦å«ï¼ˆå¹´è½»çš„å¥³æ­Œæ‰‹ï¼‰
- **è¡¨æ¼”åœ°ç‚¹**ï¼šèˆå°
- **èƒŒæ™¯éŸ³ä¹**ï¼šæ­Œæ›²ã€Šä¸‹ä¸€ä¸ªå¤©äº®ã€‹
- **åœºæ™¯å˜åŒ–**ï¼š
  - èˆå°ç¯å…‰æ•ˆæœç»šä¸½å¤šå½©ã€‚
  - é•œå¤´åˆ‡æ¢è‡³è¯„å§”å¸­å’Œè§‚ä¼—å¸­ã€‚
  - å±å¹•ä¸‹æ–¹æ˜¾ç¤ºæ­Œè¯å­—å¹•
â±ï¸  æ€»è€—æ—¶: 3.86s
ğŸ“Š è¾“å‡ºtokens: 105
ğŸ“Š ç¼–ç è€—æ—¶: N/A (cacheå¤ç”¨)

ğŸ”„ ç¬¬ 3 æ¬¡æé—®ï¼ˆStreaming è¾“å‡ºï¼Œåº”è¯¥å¤ç”¨ cacheï¼‰
ğŸ’¬ å›ç­”: è¿™ä¸ªèŠ‚ç›®æ˜¯ã€Šä¸­å›½å¥½å£°éŸ³ã€‹ï¼Œåœ¨èŠ‚ç›®ä¸­ï¼Œä¸€ä½å¹´è½»å¥³æ­Œæ‰‹è‘£ä¹¦å«æ·±æƒ…æ¼”å”±æ­Œæ›²ã€Šä¸‹ä¸€ä¸ªå¤©äº®ã€‹ã€‚å¥¹èº«ç©¿ç™½è‰²è¿è¡£è£™ï¼Œåœ¨èˆå°ä¸Šè¡¨ç°å‡ºè‰²ï¼Œå¹¶è·å¾—äº†è¯„å§”å’Œè§‚ä¼—çš„çƒ­çƒˆæŒå£°ã€‚

### è§†é¢‘å†…å®¹æ€»ç»“ï¼š

- **é€‰æ‰‹**ï¼šè‘£ä¹¦å«ï¼ˆå¹´è½»çš„å¥³æ­Œæ‰‹ï¼‰
- **è¡¨æ¼”åœ°ç‚¹**ï¼šèˆå°
- **èƒŒæ™¯éŸ³ä¹**ï¼šæ­Œæ›²ã€Šä¸‹ä¸€ä¸ªå¤©äº®ã€‹
- **åœºæ™¯å˜åŒ–**ï¼š
  - èˆå°ç¯å…‰æ•ˆæœç»šä¸½å¤šå½©ã€‚
  - é•œå¤´åˆ‡æ¢è‡³è¯„å§”å¸­å’Œè§‚ä¼—å¸­ã€‚
  - å±å¹•ä¸‹æ–¹æ˜¾ç¤ºæ­Œè¯å­—
â±ï¸  æ€»è€—æ—¶: 3.55s
ğŸ“Š è¾“å‡ºtokens: 104
ğŸ“Š ç¼–ç è€—æ—¶: N/A (cacheå¤ç”¨)

================================================================================
é˜¶æ®µ 4ï¼šæ·»åŠ æ–°å¸§ + é‡æ–°ç¼–ç 
================================================================================

â• æ·»åŠ  10 ä¸ªæ–°å¸§...

âœ… æ–°å¸§å·²æ·»åŠ ï¼Œæ–°è§†é¢‘æ—¶é•¿: 60.0s

â“ æ·»åŠ æ–°å¸§åæé—®:
   ğŸ§¹ æ˜¾å­˜é‡Šæ”¾å: å·²åˆ†é… 7.01GB, å·²ä¿ç•™ 8.20GB
   ğŸ“¹ é‡‡æ ·: 22 â†’ 48 å¸§
   â±ï¸  second_per_grid_t: 2.4583s
   ğŸ• å®é™…æ—¶é—´è·¨åº¦: 59.00s (ä» t=0.0s åˆ° t=59.0s)
   âœ… ç¼–ç å®Œæˆï¼
   â±ï¸  è€—æ—¶: 20.29s
   ğŸ¯ Visual Tokens: 64584
   ğŸ’¾ KV Cache Length: 64607
   ğŸ“ video_grid_thw: tensor([[ 24,  78, 138]], device='cuda:0')
ğŸ’¬ å›ç­”: å¥½çš„ï¼Œæˆ‘æ¥ä¸ºæ‚¨æè¿°æœ€æ–°è§†é¢‘çš„å†…å®¹ã€‚

åœ¨æ–°çš„ç”»é¢ä¸­ï¼Œä¸€ä½å¹´è½»å¥³å­©ç«™åœ¨èˆå°ä¸Šæ¼”å”±æ­Œæ›²ã€Šä¸‹ä¸€ä¸ªå¤©äº®ã€‹ã€‚å¥¹èº«ç©¿ç™½è‰²èŠ±è£™å­ï¼Œè¡¨æƒ…ä¸“æ³¨è€ŒæŠ•å…¥ï¼Œæ‰‹æŒéº¦å…‹é£æ·±æƒ…åœ°å”±ç€æ­Œã€‚èƒŒæ™¯æ˜¯ä¸€ä¸ªç°ä»£åŒ–çš„èˆå°è®¾è®¡ï¼Œå¸¦æœ‰è“è‰²å’Œçº¢è‰²ç¯å…‰æ•ˆæœï¼Œè¥é€ å‡ºä¸€ç§æ¢¦å¹»èˆ¬çš„æ°›å›´ã€‚è§‚ä¼—å¸­ä¸Šå¯ä»¥çœ‹åˆ°å‡ ä½è¯„å§”ååœ¨é»‘è‰²çš„æ¤…å­ä¸Šï¼Œä»–ä»¬ç©¿ç€æ—¶å°šçš„è¡£æœï¼Œå¹¶ä¸”æˆ´ç€è€³æœºï¼Œå…¨ç¥è´¯æ³¨åœ°çœ‹ç€å°ä¸Šçš„è¡¨æ¼”ã€‚å…¶ä¸­ä¸€åè¯„å§”æ­£åœ¨ä½¿ç”¨æ‰‹æœºè¿›è¡Œå½•éŸ³æˆ–å½•åƒï¼Œæ˜¾ç„¶å¯¹è¿™åœºè¡¨æ¼”éå¸¸æ„Ÿå…´è¶£ã€‚
ç´§æ¥ç€ï¼Œé•œå¤´åˆ‡æ¢åˆ°ä¸€ä¸ªå……æ»¡æ´»åŠ›çš„å°å¥³å­©ï¼Œå¥¹åœ¨èˆå°ä¸Šä¸å¦ä¸€ä½åŒæ ·å¹´è½»çš„å¥³æ€§äº¤æµå¹¶åˆ†äº«å¥¹ä»¬ä¹‹é—´çš„å‹è°Šæ•…äº‹ã€‚è¿™ä¸ªåœºæ™¯ç»™äººä¸€ç§æ¸©é¦¨ã€çœŸæŒšçš„æ„Ÿè§‰ï¼Œä»¿ä½›é‚€è¯·è§‚ä¼—ä¸€èµ·æ„Ÿå—è¿™æ®µæ¸©æš–çš„æ•…äº‹ã€‚

æ€»ä½“è€Œè¨€ï¼Œè¿™æ˜¯ä¸€æ®µæ—¢å±•ç¤ºäº†ä¸“ä¸šæ­Œå”±æ‰èƒ½åˆä¼ é€’äº†æ·±åˆ»æƒ…æ„Ÿçš„ç”»é¢é›†é”¦ï¼Œè®©äººæ„Ÿå—åˆ°éŸ³ä¹çš„åŠ›é‡ä»¥åŠäººä¸äººä¹‹é—´çº¯çœŸçš„ç¾å¥½è”ç³»ã€‚
ğŸ“Š æŒ‡æ ‡:
  total_latency: 29.58s
  generation_latency: 3.61s
  output_tokens: 196
  encoding_latency: 20.29s
  frames_encoded: 48
  visual_tokens: 64584

ğŸ“ æ›´æ–°åé‡‡æ ·å…ƒæ•°æ®:
  é‡‡æ ·åå¸§æ•°: 48
  second_per_grid_t: 2.4583s
  è§†é¢‘æ—¶é•¿: 59.00s

================================================================================
æœ€ç»ˆç»Ÿè®¡
================================================================================

ğŸ“Š æœ€ç»ˆå¸§ç®¡ç†ç»Ÿè®¡:
  total_frames_added: 60
  encode_count: 2
  cache_valid: True
  star_memory_size: 3
  stream_memory_size: 20
  unique_frames: 22
  compression_ratio: 2.73x
  disk_cache_enabled: True

================================================================================
âœ… æµ‹è¯•å®Œæˆ!
================================================================================
